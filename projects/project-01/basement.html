<html>

<head>
    <title>Haunted House</title>
    <link rel="icon" href="game/assets/hauntedhouse-logo.png" />
    <link href='game/styles/styler.css' rel="stylesheet">
    <link href="https://fonts.googleapis.com/css?family=Bangers" rel="stylesheet">
</head>

<body>
    <h1>Haunted House</h1>
    <hr>
    <p>Mystery is what the haunted seek, and the haunted house delivers!</p>

    <a id='door' href='#'>
        <img id='doorImage' onclick='OpenDoor()' src='game/assets/door.jpg' width="240">
    </a>
    <div id='textbox'></div>
    <br>
    <iframe src='inventory.html' id='inventory' height=100 width=200></iframe>
</body>

<script>
    // Read stats from query string
    var queryString = new URLSearchParams(location.search);
    var keys = +queryString.get("keys");
    var doorUnlocked = queryString.get("doorUnlocked") === "true";

    var doorImage = document.getElementById("doorImage");
    var textbox = document.getElementById("textbox");
    var inventory = document.getElementById("inventory");

    // Initialize inventory dynamically
    inventory.src = "inventory.html?" + queryString.toString();

    // If door already unlocked, show open state
    if (doorUnlocked) {
        doorImage.src = 'game/assets/door2.jpg';
        textbox.innerHTML = `<p>
        <a href='ghost.html?${queryString.toString()}'>Enter</a> or
        <a href='Hauntedhouse.html?${queryString.toString()}'>Leave</a>
    </p>`;
    }

    function OpenDoor() {
        if (doorUnlocked) {
            // show Enter and Leave when door is already open
            textbox.innerHTML = `<p>
            <a href='ghost.html?${queryString.toString()}'>Enter</a> or
            <a href='Hauntedhouse.html?${queryString.toString()}'>Leave</a>
        </p>`;
        }
        else if (keys > 0) {
            keys--; // use key
            doorUnlocked = true;
            queryString.set("keys", keys);
            queryString.set("doorUnlocked", true);

            doorImage.src = 'game/assets/door2.jpg';
            textbox.innerHTML =
                `The door unlocked, but the key broke apart.<br>
                <a href='ghost.html?${queryString.toString()}'>Enter</a> or
                <a href='Hauntedhouse.html?${queryString.toString()}'>Leave</a>`;

            inventory.src = "inventory.html?" + queryString.toString();
        }
        else {
            textbox.innerHTML = `
                The door is locked. Find the key.<br>
                <a href='Hauntedhouse.html?${queryString.toString()}'>Leave</a>`;
        }
    }

</script>

</html>